# Fail2ban configuration for nginx DDoS protection
# Save this as /etc/fail2ban/filter.d/nginx-ddos.conf

[Definition]

# Detect common DDoS patterns in nginx logs
failregex = ^<HOST> -.*"(GET|POST|HEAD).*" (4|5)\d{2}.*$
            ^<HOST> -.*".*" 429.*$
            ^<HOST> -.*".*\.(php|asp|jsp)" 404.*$
            ^<HOST> -.*"\w+ /\w+\?.*" 400.*$

# Ignore legitimate requests
ignoreregex = ^<HOST> -.*"(GET|POST) /api/(health|status)" 200.*$
              ^<HOST> -.*"GET /favicon.ico" 404.*$

# Time window
datepattern = %%d/%%b/%%Y:%%H:%%M:%%S

[INCLUDES]
before = common.conf